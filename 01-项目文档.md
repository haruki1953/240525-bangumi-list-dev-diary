https://github.com/haruki1953/240525-bangumi-list-dev-diary
# 一、项目介绍
这个项目叫 bangumi-list。

自己番剧小窝用的是alist，这种返璞归真的方法导致了番剧的展示不太优雅。
bangumi-list 将会完善这一方面。

bangumi-list 是一个前端，用于整理与显示番剧数据，通过番剧卡片中的 “下载/观看”按钮 可以跳转到alist。
bangumi-list 通过请求服务上的一些文件来获取番剧数据，没有真正意义上的后端，番剧数据是通过一个python爬虫生成的。

## 技术栈
- vue3
- element-plus
- python

## 项目搭建分为两期
### 一期
- 修改python爬虫，将现有爬取的数据保存在指定文件。需要注意的是，还缺少bangumi的id，也要保存。
- 夜间模式、自定义主题
- 前端：获取全部番剧数据，根据最后修改标记按需获取。
- 首页：显示当季番剧
- 番剧列表页：显示全部番剧，搜索功能，按季度分组、按评分排序、按时间排序
- 部署：实现与现有alist的兼容，现有alist网址为 bangumi.sakiko.top，尝试让前端也部署在此域名下

### 二期
- 收藏页
- 修改爬虫爬取更多信息、
- ~~番剧主页：显示更多信息~~（不用了）
- 相似番剧推荐（收藏页）
- ~~更新集数显示~~
- 公告功能


# 二、后端
感觉必须要重写了，好乱

- 生成数据

（剩下的二期再说吧）
- 改用模板引擎
- 优化结构

## 生成数据
生成的番剧数据保存在网站目录下的data文件夹下
python爬虫是通过多个`crawl_info.json`来获取数据的，根据不同的源文件生成不同的`bgm_data.json`，同时生成或修改`config.json`

### crawl_info.json
crawl_info.json，需要新增alistPath字段，在自动截取名称链接出问题时进行补正
> 一般通过saveFile字段就可以截取出正确的alist路径，但极少数情况下会有问题。如果发现这种情况，就添加正确的alistPath
```json
[
    {
        "saveFile": "/home/onedrive/Sakiko/Bangumi/BUCCHIGIRI?!/readme.md",
        "urlList": [
            {
                "source": "bangumi",
                "url": "https://bangumi.tv/subject/436745",
                "alistPath": "/Bangumi/BUCCHIGIRI？!"
            }
        ]
    }
    // ...
]
```

### config.json（一期）
config.json，负责保存生成`bgm_data.json`番剧数据，通过其中的最后修改时间，来控制前端在必要时再请求数据
（一期）
```json
{
	"bgmFileList": [
		{
			"fileName": "文件名，如 bgm_data-crawl_info_24四月.json",
			"lastModified": "最后修改时间",
			"showOnHome": "是否在首页显示"
		}
		// ...
	]
}
```
[01-项目文档【config.json设计（二期）】](01-项目文档.md#config.json设计（二期）)

### bgm_data.json
bgm_data.json保存番剧数据（二期）
```json
[
	{
		"id": "bangumi番剧ID，也在前端里用作id",
		"alistPath": "对应番剧的alist网站路径（二期变为了必须为完整网站路径）如：https://bangumi.sakiko.top/Bangumi/GIRLS%20BAND%20CRY",
		"bgmUrl": "bangumi番剧链接",
		"img": "番剧图片",
		"name": "番剧名（日语）",
		"chineseName": "中文名",
		"episode": "话数",
		"date": "放送开始日期",
		"weekday": "放送星期",
		"score": "评分",
		"tagList": ['标签1', '标签2'],
		"aliasList": ['别名1', '别名2'],
		// 为了精简，后面的没有保存
		"content": "番剧介绍",
		"charsInfo": [
			{
				"img": "角色的图片"
			}
		],
		"comments": [
			{
				"img": "用户头像",
				"name": "用户名",
				"content": "评论内容"
			}
		]
	}
]
```
还是保持精简比较好，评论什么的太大了，不保存了

### config.json设计（二期）
[config.json](code/config.json)
友情链接，联系信息，公告，版本控制
```json
{
	"version": "标识版本的字符串",
	"notification": {
		"id": "通知的标识",
		"title": "通知标题",
		"message": "通知内容",
		"type": "通知类型"
	},
	"contact": [
		{
			"link": "链接",
			"img": "图标",
			"name": "联系方式名称",
			"isRadiu": boolean
		}
	],
	"friend": [
		{
			"link": "链接",
			"img": "图标",
			"name": "联系方式名称",
			"isRadiu": boolean
		}
	],
	"bgmFileList": [
		{
			"fileName": "文件名，如 bgm_data-crawl_info_24四月.json",
			"lastModified": "最后修改时间",
			"showOnHome": "是否在首页显示"
		}
	]
}
```

#### version版本控制
前端判断请求的数据中version不一样，则重置数据

#### notification通知公告
获取到通知时，判断其是否和原先保存的id一致。不一致（或没有）则保存并为其加上 isRead: false。
在layout中初始化数据后，判断isRead为false时显示通知，过onClose回调来设置isRead=true

#### 友情链接，联系信息
保存至store，在关于页面使用
isRadiu：是否圆角



# 三、前端
请求获取config.json，并根据其内容获取bgm_data.json，通过判断lastModified在必要时重新获取……
[03-前端](03-前端.md)











