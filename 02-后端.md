https://github.com/haruki1953/crawl_post_generator

新建分支 
feature-bangumi-list-backend

优化结构之类的二期再说吧，先弄好凑活用吧

## 一期
## 生成数据
新建 bangumi_list.py

获取数据后，调用 bangumi_list 添加数据

调用 bangumi_list 保存数据

根据bash执行时的参数判断是否保存bangumi_list
存在第二参数时：
为'BL'时启用bangumi-list，为'onlyBL'时不保存html

完成，爬一下现有数据


## 二期
- 改用模板引擎
- 优化结构
- 爬取标签、别名
- 优化页面、暗黑模式
- config.json设计，友链、公告


## 改用模板引擎
pip install jinja2
完善一下requirements.txt
```
beautifulsoup4==4.12.2
jinja2==3.1.4
```
pip show jinja2 查看版本
pip install -r requirements.txt 安装

改一下目录
my_crawlers改为crawlers
创建templates文件夹，用于存放html模板
> my_templates暂时保留，最终要删除
> 注意，已经给所有带my的数据去掉了

在templates文件夹下，创建：
- main.html 主模板
- thread-default.html 帖子默认模板
- thread-bangumi.html 番剧模板

[python模板引擎jinja2【案例】](笔记/python模板引擎jinja2.md#案例)
原来可以在模板里进行全部的逻辑判断，这下简单了
generate_html中可以直接用threadDataList调用模板引擎

```
改模板替换正则
\{(\b.*?\b)\}
{{ thread.data.MainPost.$1 }}
```

main.html
```html
<thread-list>
    {% for thread in threadDataList %}
        {% if thread.source == 'default' %}
            {% include 'thread-default.html' %}
        {% elif thread.source == 'bangumi' %}
            {% include 'thread-bangumi.html' %}
        {% endif %}
    {% endfor %}
</thread-list>
```

完成
现在可以删除my_templates

## 优化结构
将 bgmDataSavePath 与 alistBasePath 封装至 setting.py

## 爬取标签、别名
番剧介绍介绍感觉用处不大，不保存了
### 别名
模仿以前写的进行匹配
```python
# 正则表达式匹配获取信息
""" BANGUMI_CHINESE """
match = re.search(
	r'<li><span class="tip">中文名: </span>(.*?)</li>', infoBoxStr)
MainPost['BANGUMI_CHINESE'] = match.group(1) if match else ''

""" BANGUMI_ALIAS_LIST """
matches = re.findall(
	r'<li><span class="tip".*?>别名: </span>(.*?)</li>', infoBoxStr)
MainPost['BANGUMI_ALIAS_LIST'] = matches if matches else []
print(MainPost['BANGUMI_ALIAS_LIST'])
```

## 标签
先找到 div id="subject_detail" 再找到 div class="subject_tag_section" 其中保存着番剧标签，然后用正则表达式匹配
```html
<a class="l" href="/anime/tag/%E7%BE%8E%E9%A3%9F"><span>美食</span>
<a class="l" href="/anime/tag/.*?"><span>(.*?)</span>
```
```python
""" BANGUMI_TAG_LIST """
# 先找到 div id="subject_detail" 再找到 div class="subject_tag_section"
# 其中保存着番剧标签，然后用正则表达式匹配
bangumiTagSection = postSoup.find('div', {'id': 'subject_detail'}).find(
    'div', {'class': 'subject_tag_section'})
tagSectionStr = str(bangumiTagSection)
matches = re.findall(
    r'<a class="l" href="/anime/tag/.*?"><span>(.*?)</span>', tagSectionStr)
MainPost['BANGUMI_TAG_LIST'] = matches if matches else []
print(MainPost['BANGUMI_TAG_LIST'])
```
完成


## TODO
- 番剧介绍忘了
- 爬取标签
- 别名



